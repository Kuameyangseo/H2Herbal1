{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Admin</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('admin.orders') }}">Orders</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Order #{{ order.order_number }}</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-6 fw-bold text-success mb-3">
                <i class="fas fa-box me-2"></i>Order Details
            </h1>
            <p class="lead text-muted">Order #{{ order.order_number }}</p>
        </div>
    </div>

    <div class="row">
        <!-- Order Information -->
        <div class="col-lg-8 mb-4">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Order Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">Order Details</h6>
                            <p class="mb-1"><strong>Order Number:</strong> {{ order.order_number }}</p>
                            <p class="mb-1"><strong>Order Date:</strong> {{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                            <p class="mb-1"><strong>Status:</strong> 
                                <span class="badge bg-{{ order.get_status_color() }}">{{ order.status.title() }}</span>
                            </p>
                            <p class="mb-1"><strong>Payment Status:</strong> 
                                <span class="badge bg-{{ 'success' if order.payment_status == 'paid' else 'warning' if order.payment_status == 'pending' else 'danger' }}">{{ order.payment_status.title() }}</span>
                            </p>
                            <p class="mb-1"><strong>Payment Method:</strong> {{ order.payment_method or 'N/A' }}</p>
                            <p class="mb-0"><strong>Payment Reference:</strong> {{ order.payment_reference or 'N/A' }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted">Order Totals</h6>
                            <p class="mb-1"><strong>Subtotal:</strong> GH₵{{ "%.2f"|format(order.subtotal) }}</p>
                            <p class="mb-1"><strong>Tax:</strong> GH₵{{ "%.2f"|format(order.tax_amount) }}</p>
                            <p class="mb-1"><strong>Shipping:</strong> GH₵{{ "%.2f"|format(order.shipping_cost) }}</p>
                            <p class="mb-1"><strong>Discount:</strong> GH₵{{ "%.2f"|format(order.discount_amount) }}</p>
                            <p class="mb-0"><strong>Total:</strong> <span class="fw-bold fs-5">GH₵{{ "%.2f"|format(order.total_amount) }}</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Items -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-boxes me-2"></i>Order Items</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Product</th>
                                    <th>SKU</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in order.items %}
                                <tr>
                                    <td>{{ item.product_name }}</td>
                                    <td>{{ item.product_sku or 'N/A' }}</td>
                                    <td>GH₵{{ "%.2f"|format(item.unit_price) }}</td>
                                    <td>{{ item.quantity }}</td>
                                    <td>GH₵{{ "%.2f"|format(item.total_price) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Information -->
        <div class="col-lg-4 mb-4">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-user me-2"></i>Customer Information</h5>
                </div>
                <div class="card-body">
                    <h6 class="text-muted">Customer Details</h6>
                    <p class="mb-1"><strong>Name:</strong> {{ order.shipping_first_name }} {{ order.shipping_last_name }}</p>
                    <p class="mb-1"><strong>Email:</strong> {{ order.shipping_email }}</p>
                    <p class="mb-1"><strong>Phone:</strong> {{ order.shipping_phone or 'N/A' }}</p>
                    
                    <h6 class="text-muted mt-3">Shipping Address</h6>
                    <p class="mb-1"><strong>Address:</strong> {{ order.shipping_address }}</p>
                    <p class="mb-1"><strong>City:</strong> {{ order.shipping_city }}</p>
                    <p class="mb-1"><strong>Country:</strong> {{ order.shipping_country }}</p>
                    <p class="mb-0"><strong>Postal Code:</strong> {{ order.shipping_postal_code or 'N/A' }}</p>
                </div>
            </div>

            <!-- Update Status -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="fas fa-edit me-2"></i>Update Status</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin.update_order_status', id=order.id) }}">
                        {{ form.hidden_tag() }}
                        
                        <div class="mb-3">
                            {{ form.status.label(class="form-label") }}
                            {{ form.status(class="form-select") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.payment_status.label(class="form-label") }}
                            {{ form.payment_status(class="form-select") }}
                        </div>
                        
                        <div class="d-grid">
                            {{ form.submit(class="btn btn-primary") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}